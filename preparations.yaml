---
# A list of variables that must be set for all elements
preamble:
    LC_ALL: POSIX
    WANDER: /mnt/wander
    WANDER_TGT: '{arch}-wander-linux-gnu'
    PATH: /tools/bin:/bin:/usr/bin
# The user that must run this section
user: root
# The elements, each representing one unit to execute
elements:
    baseDir:
        description: Creating base directory
        test: 0
        commands:
            - mkdir -pv $WANDER
    mountfs:
        description: Mounting base partition
        test: 0
        commands:
            - mount -v -t ext4 $LOCATION $WANDER
    toolsDir:
        description: Creating tools directory
        test: 0
        commands:
            - mkdir -v $WANDER/tools
    toolsLink:
        description: Setting /tools symlink
        test: 0
        commands:
            - ln -sv $WANDER/tools /
    sourcesDir:
        description: Creating sources directory
        test: 0
        commands:
            - mkdir -v $WANDER/sources
    sourcesSticky:
        description: Making the sources directory sticky
        test: 0
        commands:
            - chmod -v a+wt $WANDER/sources
    groupadd:
        description: Creating the user group
        test: 0
        commands:
            - groupadd wander
    useradd:
        description: Adding the user for building packages
        test: 0
        commands:
            - useradd -s /bin/bash -g wander -m -k /dev/null wander
    toolsPermission:
        description: Setting tools directory permissions
        test: 0
        commands:
            - chown -v -R wander $WANDER/tools
    sourcesPermission:
        description: Setting sources directory permissions
        test: 0
        commands:
            - chown -v -R wander $WANDER/sources
    cleanProfile:
        description: Cleaning previous build environment
        test: 0
        commands:
            - rm /home/wander/.bash_profile
            - rm /home/wander/.bashrc
    bashProfile:
        description: Creating build environment
        test: 0
        commands:
            - printf "exec env -i HOME=$HOME TERM=$TERM PS1='\u:\w\$ ' /bin/bash" >> /home/wander/.bash_profile
            - printf "set +h\numask 022\nWANDER=$WANDER\nLC_ALL=$LC_ALL\nWANDER_TGT=$WANDER_TGT\nPATH=$PATH\nexport WANDER LC_ALL WANDER_TGT PATH" >> /home/wander/.bashrc
...
