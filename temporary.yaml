---
# A list of variables that must be set for all elements
preamble:
    LC_ALL: POSIX
    WANDER: /mnt/wander
    WANDER_TGT: x86_64-wander-linux-gnu
    PATH: /tools/bin:/bin:/usr/bin
# The elements, each representing one unit to execute
elements:
    binutils:
        description: Binutils (Pass 1)
        version: 2.32
        url: http://ftp.gnu.org/gnu/binutils/binutils-2.32.tar.xz
        md5: 0d174cdaf85721c5723bf52355be41e6
        folder: build
        commands:
            preparation:
                - ../configure --prefix=/tools --with-sysroot=$WANDER --with-lib-path=/tools/lib --target=$WANDER_TGT --disable-nls --disable-werror
            compilation:
                - make
            configuration:
                - mkdir -v /tools/lib && ln -sv lib /tools/lib64
            installation:
                - make install
    gcc:
        description: GCC (Pass 1)
        version: 9.2.0
        url: http://ftp.gnu.org/gnu/gcc/gcc-9.2.0/gcc-9.2.0.tar.xz
        md5: 3818ad8600447f05349098232c2ddc78
        modules:
            mpfr:
                description: MPFR
                version: 4.0.2
                url: http://www.mpfr.org/mpfr-4.0.2/mpfr-4.0.2.tar.xz
                md5: 320fbc4463d4c8cb1e566929d8adc4f8
                folder: mpfr
            gmp:
                description: GMP
                version: 6.1.2
                url: http://ftp.gnu.org/gnu/gmp/gmp-6.1.2.tar.xz
                md5: f58fa8001d60c4c77595fbbb62b63c1d
                folder: gmp
            mpc:
                description: MPC
                version: 1.1.0
                url: http://ftp.gnu.org/gnu/mpc/mpc-1.1.0.tar.gz
                md5: 4125404e41e482ec68282a2e687f6c73
                folder: mpc
        folder: build
        commands:
            preparation:
                - for file in gcc/config/{linux,i386/linux{,64}}.h; do (cp -uv $file{,.orig}; sed -e 's@/lib\(64\)\?\(32\)\?/ld@/tools&@g' -e 's@/usr@/tools@g' $file.orig > $file; printf '#undef STANDARD_STARTFILE_PREFIX_1\n#undef STANDARD_STARTFILE_PREFIX_2\n#define STANDARD_STARTFILE_PREFIX_1 "/tools/lib"\n#define STANDARD_STARTFILE_PREFIX_2 ""\n' >> $file; touch $file.orig)
                - ../configure --target=$WANDER_TGT --prefix=/tools --with-glibc-version=2.11 --with-sysroot=$WANDER --with-newlib --without-headers --with-local-prefix=/tools --with-native-system-header-dir=/tools/include --disable-nls --disable-shared --disable-multilib --disable-decimal-float --disable-threads --disable-libatomic --disable-libgomp --disable-libquadmath --disable-libssp --disable-libvtv --disable-libstdcxx --enable-languages=c,c++
                - sed -e '/m64=/s/lib64/lib/' -i.orig gcc/config/i386/t-linux64
            compilation:
                - make
            installation:
                - make install
...
